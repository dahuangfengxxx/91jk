<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯• - éšæ¯å±…</title>
    <link rel="stylesheet" href="assets/css/styles.css?v=4">
    <link rel="stylesheet" href="assets/css/enhancements.css?v=4">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            margin: 5px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-results {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª éšæ¯å±…åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
        
        <div class="test-section">
            <h2>æ•°æ®åŠ è½½æµ‹è¯•</h2>
            <button class="test-button" onclick="testDataLoading()">æµ‹è¯•æ•°æ®åŠ è½½çŠ¶æ€</button>
            <button class="test-button" onclick="testTomatoData()">æŸ¥æ‰¾è¥¿çº¢æŸ¿æ•°æ®</button>
            <div id="data-results" class="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>UIåŠŸèƒ½æµ‹è¯•</h2>
            <button class="test-button" onclick="testShowDetails()">æµ‹è¯•è¯¦æƒ…æ˜¾ç¤º</button>
            <button class="test-button" onclick="testPopularIngredients()">æ˜¾ç¤ºå¸¸ç”¨é£Ÿæ</button>
            <div id="ui-results" class="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>å®é™…æ•°æ®æ˜¾ç¤º</h2>
            <div id="search-results" class="results-grid"></div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: flex;">
        <div class="loading-spinner">
            <p>æ­£åœ¨åŠ è½½æ•°æ®...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/config.js?v=4"></script>
    <script src="assets/js/secureDataManager.js?v=4"></script>
    <script src="assets/js/simpleApp.js?v=4"></script>
    
    <script>
        // æµ‹è¯•å‡½æ•°
        async function testDataLoading() {
            const results = document.getElementById('data-results');
            results.textContent = 'æ­£åœ¨æµ‹è¯•æ•°æ®åŠ è½½...\n';
            
            try {
                if (window.dataManager) {
                    results.textContent += `æ•°æ®ç®¡ç†å™¨çŠ¶æ€: ${window.dataManager.isLoaded ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}\n`;
                    results.textContent += `é£Ÿææ•°é‡: ${window.dataManager.ingredients?.length || 0}\n`;
                    results.textContent += `é…æ–¹æ•°é‡: ${window.dataManager.recipes?.length || 0}\n`;
                    
                    if (!window.dataManager.isLoaded) {
                        results.textContent += 'å°è¯•åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨...\n';
                        const success = await window.dataManager.initialize();
                        results.textContent += `åˆå§‹åŒ–ç»“æœ: ${success ? 'æˆåŠŸ' : 'å¤±è´¥'}\n`;
                    }
                } else {
                    results.textContent += 'é”™è¯¯: æ•°æ®ç®¡ç†å™¨æœªæ‰¾åˆ°\n';
                }
            } catch (error) {
                results.textContent += `é”™è¯¯: ${error.message}\n`;
            }
        }
        
        function testTomatoData() {
            const results = document.getElementById('data-results');
            results.textContent = 'æ­£åœ¨æŸ¥æ‰¾è¥¿çº¢æŸ¿æ•°æ®...\n';
            
            if (window.dataManager && window.dataManager.ingredients) {
                const tomato = window.dataManager.ingredients.find(item => item.name_zh === 'è¥¿çº¢æŸ¿');
                if (tomato) {
                    results.textContent += 'âœ… æ‰¾åˆ°è¥¿çº¢æŸ¿æ•°æ®:\n';
                    results.textContent += JSON.stringify(tomato, null, 2);
                } else {
                    results.textContent += 'âŒ æœªæ‰¾åˆ°è¥¿çº¢æŸ¿æ•°æ®\n';
                    results.textContent += 'å¯ç”¨é£Ÿæç¤ºä¾‹:\n';
                    const samples = window.dataManager.ingredients.slice(0, 5).map(item => item.name_zh);
                    results.textContent += samples.join(', ');
                }
            } else {
                results.textContent += 'âŒ æ•°æ®ç®¡ç†å™¨æˆ–é£Ÿææ•°æ®æœªåŠ è½½\n';
            }
        }
        
        function testShowDetails() {
            const results = document.getElementById('ui-results');
            results.textContent = 'æ­£åœ¨æµ‹è¯•è¯¦æƒ…æ˜¾ç¤º...\n';
            
            if (window.app) {
                try {
                    window.app.showDetails('è¥¿çº¢æŸ¿', 'ingredient');
                    results.textContent += 'âœ… è°ƒç”¨showDetailsæˆåŠŸ\n';
                } catch (error) {
                    results.textContent += `âŒ è°ƒç”¨showDetailså¤±è´¥: ${error.message}\n`;
                }
            } else {
                results.textContent += 'âŒ Appå®ä¾‹æœªæ‰¾åˆ°\n';
            }
        }
        
        function testPopularIngredients() {
            const results = document.getElementById('ui-results');
            results.textContent = 'æ­£åœ¨æ˜¾ç¤ºå¸¸ç”¨é£Ÿæ...\n';
            
            if (window.app) {
                try {
                    window.app.displayPopularIngredients();
                    results.textContent += 'âœ… è°ƒç”¨displayPopularIngredientsæˆåŠŸ\n';
                } catch (error) {
                    results.textContent += `âŒ è°ƒç”¨å¤±è´¥: ${error.message}\n`;
                }
            } else {
                results.textContent += 'âŒ Appå®ä¾‹æœªæ‰¾åˆ°\n';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ§ª æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿåˆå§‹åŒ–åº”ç”¨
            setTimeout(async () => {
                if (!window.app) {
                    window.app = new SimpleApp();
                    await window.app.init();
                }
                
                // è‡ªåŠ¨è¿è¡Œæ•°æ®åŠ è½½æµ‹è¯•
                await testDataLoading();
            }, 1000);
        });
    </script>
</body>
</html>